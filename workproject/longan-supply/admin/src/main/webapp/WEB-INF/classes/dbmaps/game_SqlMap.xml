<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="game">
	<resultMap class="com.longan.biz.dataobject.Game" id="gameResult">
		<result column="id" jdbcType="BIGINT" property="id" />
		<result column="gmt_create" jdbcType="DATETIME" property="gmtCreate" />
		<result column="gmt_modify" jdbcType="DATETIME" property="gmtModify" />
		<result column="carrier_id" jdbcType="BIGINT" property="carrierId" />
		<result column="official_url" jdbcType="VARCHAR" property="officialUrl" />
		<result column="game_name" jdbcType="VARCHAR" property="gameName" />
		<result column="logo" jdbcType="VARCHAR" property="logo" />
		<result column="game_desc" jdbcType="VARCHAR" property="gameDesc" />
		<result column="status" jdbcType="INTEGER" property="status" />
		<result column="key_index" jdbcType="VARCHAR" property="keyIndex" />
		<result column="biz_id" jdbcType="INTEGER" property="bizId" />
	</resultMap>

	<sql id="gameFullColumns">
		id, gmt_create, gmt_modify, carrier_id, official_url,
		game_name, logo, game_desc, status, key_index, biz_id
	</sql>

	<select id="selectByPrimaryKey" parameterClass="com.longan.biz.dataobject.Game"
		resultMap="gameResult">
		select
		<include refid="game.gameFullColumns" />
		from game
		where id =
		#id:BIGINT#
	</select>

	<insert id="insert" parameterClass="com.longan.biz.dataobject.Game">
		insert into game (
		<include refid="game.gameFullColumns" />
		) values (#id:BIGINT#, now(), now(), #carrierId:BIGINT#,
		#officialUrl:VARCHAR#, #gameName:VARCHAR#, #logo:VARCHAR#,
		#gameDesc:VARCHAR#, #status:INTEGER#, #keyIndex:VARCHAR#,
		#bizId:INTEGER#)
		<selectKey resultClass="Long" keyProperty="id">
			SELECT
			LAST_INSERT_ID()
		</selectKey>
	</insert>

	<sql id="whereConditions">
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="id">
				id =
				#id#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="gameName">
				game_name like
				CONCAT('%', #gameName#, '%')
			</isNotEmpty>
			<isNotEmpty prepend="and" property="carrierId">
				carrier_id =
				#carrierId#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="keyIndex">
				key_index =
				#keyIndex#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="status">
				status =
				#status#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="startGmtCreate">
				gmt_create &gt;
				#startGmtCreate#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="endGmtCreate">
				gmt_create &lt;
				DATE_ADD(#endGmtCreate#,INTERVAL 1 DAY)
			</isNotEmpty>
		</dynamic>
	</sql>

	<update id="updateByPrimaryKey" parameterClass="com.longan.biz.dataobject.Game">
		update game
		set gmt_modify = now()
		<dynamic>
			<isNotNull prepend="," property="gameName">
				game_name =
				#gameName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="carrierId">
				carrier_id = #carrierId:BIGINT#
			</isNotNull>
			<isNotNull prepend="," property="officialUrl">
				official_url =
				#officialUrl:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="logo">
				logo =
				#logo:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="gameDesc">
				game_desc =
				#gameDesc:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="keyIndex">
				key_index =
				#keyIndex:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="status">
				status = #status:INTEGER#
			</isNotNull>
		</dynamic>
		where id = #id:BIGINT#
	</update>

	<select id="queryByPage" resultMap="gameResult">
		select
		<include refid="game.gameFullColumns" />
		FROM game INNER
		JOIN
		(SELECT id FROM
		game
		<include refid="game.whereConditions" />
		ORDER BY
		gmt_create DESC LIMIT #startRow#,#pageSize#) as page using
		(id)
	</select>

	<select id="queryByPageCount" resultClass="java.lang.Integer">
		SELECT count(*)
		FROM game
		<include refid="game.whereConditions" />
	</select>

	<select id="queryAll" resultMap="gameResult">
		select
		<include refid="game.gameFullColumns" />
		FROM game
		<include refid="game.whereConditions" />
		ORDER BY id ASC
	</select>
</sqlMap>