<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>账户资金流水查询</title>
    #parse("common/common.vm")  
    #parse("common/select.vm")
    #parse("common/pagination.vm")
    <link rel="stylesheet" type="text/css" href="$!staticServer/css/base.css" />
    <link rel="stylesheet" type="text/css" href="$!staticServer/css/list-common.css" />
    <link rel="stylesheet" type="text/css" href="$!staticServer/css/doubleDate.css" />
    <script type="text/javascript" src="$!staticServer/js/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="$!staticServer/js/jquery-ui-1.8.22.custom.min.js"></script>
    <link rel="stylesheet" type="text/css" href="$!staticServer/css/ui-lightness/jquery-ui-1.8.22.custom.css" />
    <script type="text/javascript" src="$!staticServer/js/tip.js"></script>
	<script type="text/javascript" src="$!staticServer/js/doubleDate2.0.js"></script>
	
</head>
<body class="list-body">
    $!errorMsg
    <div class="list-container">
        <div class="alert-title fz-16">账户资金流水查询</div>
         <form id="acctLogQueryForm" class="queryForm" action="queryAcctLog.do" method="post">
                
            <table class="table query-style table-striped table-bordered table-condensed">
                <thead>
                    <tr>
                        <td colspan="8" class="auto-style2">请填写查询条件 </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="w-8em">资金流水号</td>
                        <td class="detail ">
                            <input type="text" name="id" value="$!acctLogQuery.id"  />
                        </td>
                        <td class="w-8em">代理商名</td>
                        <td class="detail">
                            #select($!downStreamUser,'userId',$!acctLogQuery.userId)
                        </td>
                        <td class="w-8em">账户编号</td>
                        <td class="detail">
                            <input type="text" class="input-small" name="acctId" value="$!acctLogQuery.acctId"  />
                        </td>
                        <td class="w-8em">订单号</td>
                        <td class="detail">
                            <input type="text" class="input-small" name="bizOrderId" value="$!acctLogQuery.bizOrderId"  />
                        </td>
                    </tr>
                    <tr>
                        <td class="w-8em">商品名</td>
                        <td class="detail">
                           #selectClassMedium($!itemList,'itemId',$!acctLogQuery.itemId) 
                        </td>
                        
                        <td class="w-8em">交易单号</td>
                        <td class="detail">
                            <input type="text" class="input-small" name="billId" value="$!acctLogQuery.billId"  />
                        </td>               
                        <td class="w-8em">交易类型 </td>
                        <td class="detail">
                            #select($!billTypeList,'billType',$!acctLogQuery.billType)
                        </td>
                        <td class="w-8em">收支类型 </td>
                        <td class="detail">
                            #select($!tradeTypeList,'tradeType',$!acctLogQuery.tradeType)
                        </td>                   
                    </tr>
                    <tr>
                        <td class="w-8em">创建日期 </td>
                        <td class="detail" colspan="3">
                            <div class="input-append">
                                <span class="input-date">
                                    <input class="doubledate input-small" readonly="readonly" size="10" type="text" name="startGmtCreate" value="$!dateTool.format("yyyy-MM-dd", $!acctLogQuery.startGmtCreate)" />
                                    <span class="add-on"><img src="../img/date.png"></span>
                                </span>至
                                <span class="input-date">
                                    <input id="endtime" class="doubledate input-small" readonly="readonly" type="text" name="endGmtCreate" value="$!dateTool.format("yyyy-MM-dd", $!acctLogQuery.endGmtCreate)" />
                                    <span class="add-on"><img src="../img/date.png"></span>
                                </span>
                            </div>
                        </td>
                        
                    #if(!$!userInfo.isDownStreamUser())
                        <td class="w-8em">供货商</td>
                        <td class="detail">
                           #selectClassMedium($!upStreamUserList,'upStreamId',$!acctLogQuery.upStreamId) 
                        </td>
                    #else
                        <td></td>
                        <td></td>
                    #end
                    </tr>
                    <tr>
                        <td colspan="8" align="left">
                            <a class="btn btn-inverse"  onclick="javascript:query();"  >查询</a>
                            <input class="btn btn-inverse" type="reset" value="清空" />
                            <a class="btn btn-inverse"  onclick="javascript:fileExport()" >导出</a>
                        </td>
                    </tr>
                </tbody>
             </table>

        <table class="table table-list table-striped table-bordered table-condensed" id="list">
            <thead>
                <tr class="tr_detail">
                    <td>资金流水号 </td>
                    <td>商品名</td>
                    <td>代理商号</td>
                    <td>账户编号</td>           
                    <td>收入金额(元)</td>
                    <td>支出金额(元)</td>
                    <td>瞬间余额(元)</td>
                    <td>收支类型</td>
                    <td>交易号 </td>
                    <td>交易类型</td>
                    <td>交易时间</td>
                    <td>订单号</td>
                    <td>状态 </td>
                </tr>
            </thead>
            <tbody>
                #foreach($!acctLog in $!acctLogList)
                    <tr>
                    <td>$!acctLog.id</td>
                    <td>$!acctLog.itemName</td>
                    <td><a href="../user/userInfoShow.do?id=$!acctLog.userId" >$!acctLog.userId</a></td>
                    <td><a href="../user/userInfoShow.do?id=$!acctLog.userId" >$!acctLog.acctId</a></td>
                    <td>$!acctLog.amtInDesc</td>
                    <td>$!acctLog.amtOutDesc</td>
                    <td>$!acctLog.amtBalanceDesc</td>
                    <td>$!acctLog.tradeTypeDesc</td>
                    <td>$!acctLog.billId</td>
                    <td>$!acctLog.billTypeDesc</td>
                    <td>$!dateTool.format("yyyy-MM-dd HH:mm:ss", $!acctLog.gmtCreate)</td>
                    <td>$!acctLog.bizOrderId</td>
                    <td>
                        <font #if($!acctLog.showRed())color=red #end #if($!acctLog.showGreen())color=green #end >
                        $!acctLog.statusDesc
                        </font>
                    </td>
                </tr>
                #end
                
            </tbody>
        </table>
        #pagination2($!acctLogQuery,'acctLogQueryForm','queryAcctLog.do')
        
        </form>
    </div>
     
    <script type="text/javascript">
        $(function(){
        $('.doubledate').kuiDate({
            className:'doubledate',
            isDisabled: "1"
        });
        });
        
        
        function submitCheck()
        {
        	if(!checkDate()){
    			return false;
    		}
        	return true;
        }
		
		
        var checkDate = function()
        {
        	var start_date =  jQuery("input[name='startGmtCreate']").val();
        	var end_date = jQuery("input[name='endGmtCreate']").val();
        	var objDate=new Date();
        	var year = objDate.getFullYear();
        	var month = objDate.getMonth() + 1;
        	var day = objDate.getDate();
        	month = month>=10?month:'0'+month;
        	day = day>=10?day:'0'+day;
        	var date = year + "-" + month + "-" + day;
        	
        	if(!compareDate(start_date, date)){
        		alert("起始日期不能大于当前日期！");
        		return false;
        	}
        	if(!compareDate(end_date, date)){
        		alert("终止日期不能大于当前日期！");
        		return false;
        	}
        	
        	if(!compareDate(start_date, end_date))
        	{
        		alert("起始日期不能大于终止日期!");
        		return false;
        	}
        	var  beginTime   =   new   Date(Date.parse(start_date.replace(/-/g,   "/")));
        	var  endTime   =   new   Date(Date.parse(end_date.replace(/-/g,   "/"))); 
        	var onemonthe=2*30*24*60*60*1000;
        	
        	if((endTime-beginTime)>onemonthe)
        	{
        		alert("只能查二个月之内的记录!");
        		return false;
        	}	
        	return true; 
   	 	}
    
        function compareDate(date1, date2){
        	year1 = date1.substring(0,date1.indexOf("-"));
            year2 = date2.substring(0,date2.indexOf("-"));
            month1 = date1.substring(date1.indexOf("-") + 1,date1.lastIndexOf("-"));
            month2 = date2.substring(date2.indexOf("-") + 1,date2.lastIndexOf("-"));
            day1 = date1.substring(date1.lastIndexOf("-") + 1);
            day2 = date2.substring(date2.lastIndexOf("-") + 1);
            
            if(year1 > year2){
                return false;
            } else if(year1 < year2){
            	return true;
            } else if(month1 > month2){
                return false;
            } else if(month1 < month2){
            	return true;
            } else if(day1 > day2){
                return false;
            } else if(day1 < day2){
            	return true;
            }
            return true;
        }
        
        function query(){
			jQuery('#acctLogQueryForm').attr("action", "queryAcctLog.do");
			jQuery('#acctLogQueryForm').submit();
		}
        
    	function fileExport(){
			jQuery('#acctLogQueryForm').attr("action", "acctLogExport.do");
			jQuery('#acctLogQueryForm').submit();
		}	
    </script>
</body>
</html>
