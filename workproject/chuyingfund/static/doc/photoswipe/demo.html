<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8" />
    <meta HTTP-EQUIV="pragma" CONTENT="no-cache">
    <meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
    <meta HTTP-EQUIV="expires" CONTENT="0">
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="pragram" content="no-cache" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="telephone=no,email=no" name="format-detection" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <title>PhotoSwipe</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/static/assets/css/mobile/base.css">
    <script src="/static/assets/vendor/seajs/2.0.0/sea.js"></script>
    <script src="/static/assets/js/config.js"></script>
    <style>
    .feed-container {
        max-width: 640px;
        margin: 0 auto;
        padding-top: 30px;
        
    }

    </style>
    </head>
    <body >
        
<div class="feed-container">

    
    
    <h2>
        <button class="btn btn-primary btn-publish" data-toggle="modal" data-target=".modal-feed" data-backdrop="static">我要发布动态</button>
    </h2>
    
    <div class="feed-list feed-no-avatar">
        <div class="feed-item">

            <div class="feed-content">
                
                <div class="feed-text">近日，北大一硕士论文因其主题研究身体和情趣走红校园，该论文也被称为“史上最羞羞的毕业论文”http://ww1.sinaimg.cn/orj480/4364c6bejw1f47eflzm6bj20e60e6760.jpg</div>
                <div class="feed-photo">
                    <ul class="feed-photo-list">
                        <li class="feed-photo-item" data-role="photoItem" data-original="1.jpg">
                            <img src="http://ww2.sinaimg.cn/thumb180/afb4603bgw1f46h8acklbj20500500sq.jpg" alt="" />
                        </li>
                        <li class="feed-photo-item" data-role="photoItem" data-original="2.jpg">
                            <img src="http://ww2.sinaimg.cn/thumb180/afb4603bgw1f46h8acklbj20500500sq.jpg" />
                        </li>
                        <li class="feed-photo-item" data-role="photoItem" data-original="3.jpg">
                            <img src="http://ww2.sinaimg.cn/thumb180/afb4603bgw1f46h8acklbj20500500sq.jpg" alt=""  />
                        </li>
                        
                    </ul>
                </div>
                <div class="feed-info">
                    <span>发布时间：</span><span class="feed-date">2015-12-12 08:08:12</span>
                </div>
            </div>
        </div>
       
        <div class="feed-item">
            
            <div class="feed-content">
               
                <div class="feed-text">近日，被称为“史上最羞羞的毕业论文”</div>
                <div class="feed-info">
                    <span class="feed-date">2015-12-12 08:08:12</span>
                </div>
                
            </div>
        </div>


    </div>


</div>


<!-- 发布动态 -->
<div class="modal modal-feed fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/static/assets/data/feed.json" method="get" class="ajax-form form-feed" >
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">发布动态</h4>
                </div>
                <div class="modal-body" id="feed-table-body">
                    
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn-primary pl-10 pr-10">提交</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- 发布模板 -->
<script type="text/html" id="feedPublish">
    <table class="feed-table">
        <tr>
            <td class="w-20"><label>发布内容</label></td>
            <td>
                <div class="ctrl-wrap">
                    <textarea name="content"  rows="4" required maxlength="200"></textarea>
                </div>
            </td>
        </tr>
        <tr>
            <td class="w-20"><label>相关照片</label></td>
            <td class="wu hidden wu-feed" >
                <!-- 地址 -->
                <input type="hidden" name="photo" value="" class="file-upload">
                
                <div class="queue-box">
                    <div class="file-list">
                        <div class="pick-wrap add">
                            <!-- 参数设置 -->
                            <div class="pick pick-plus" data-multiple="true" data-param='{"action":"image.200","flag":1}'>+</div>
                        </div>
                    </div>
                </div>
                
            </td>
        </tr>
        
    </table>
</script>



<!-- 动态展现模板 -->
<script type="text/html" id="feed-item">
    <div class="feed-item">
        <div class="feed-content">
            <div class="feed-text">{{content}}</div>
            {{ if photo }}
            <div class="feed-photo">
            
                <ul class="feed-photo-list">
                    {{each _photo}}
                    <li class="feed-photo-item">
                        <a href="javascript:;" class="feed-photo-link" data-role="photoItem" ata-original="{{$value}}">
                            <img src="{{$value}}" alt="">
                        </a>
                    </li>
                    {{/each}}
                </ul>

            {{/if}}
            </div>

            <div class="feed-info">
                <span class="c-9">发布时间：</span><span class="feed-date">{{date}}</span>
            </div>
        </div>
    </div>
</script>
<!-- 图片上传模板 -->
<script type="text/html" id="file-item">
    <div id="{{id}}" class="file-item">
        <div class="title">{{name}}</div>
        <div class="img-wrap"></div>
        <div class="progress"><span></span></div>
        <div class="float-bar">
            <span class="fr close">&times;</span>
        </div>
        <div class="info"></div>
        <div class="success" style="display:none;"></div>
    </div>
</script>



<script type="text/javascript">
    seajs.use(['webuploader','template','dm.ajaxpost','dm.modal','dm.validate','dm.wu','dm.util','dm.photoswipe'],function(){

        console.log('run');

        $(function(){

            var $modalFeed = $('.modal-feed'),$feedBody = $('#feed-table-body'),uploader;

            $modalFeed.on('shown', function () {
                
                $modalFeed.find('.wu').wu({
                    fileNumLimit:9
                }).removeClass('hidden');
                $modalFeed.find('form').validate('init').find('input[maxlength], textarea[maxlength]').not('[nocount]').wordCount();
                window.wu2 = true;
                uploader = $modalFeed.find('.wu').data('uploader');
                uploader.on('uploadFinished',function(){
                    console.log('uploadFinished')
                });
                
                
            }).on('hidden', function () {
                $feedBody.empty();
                
            });

            $('.btn-publish').on('click',function(){
                $feedBody.html(template('feedPublish', {}));
            });
            $('.form-feed').on('success',function(e,res){
                var data = res.data || {};

                if(data.photo) {
                    data._photo = data.photo.split(',');
                }
                var html = template('feed-item', data);
                $('.feed-list').prepend(html);
                $modalFeed.modal('hide');
                console.log('success')
            });

            
            
        });
    });


</script>
    </body>
</html>